parameters:
- name: action
  type: string

steps:
- task: Bash@3
  displayName: 'VM Action: ${{ parameters.action }}'
  inputs:
    targetType: 'inline'
    script: |
      case "${{ parameters.action }}" in
        "create")
          echo "ğŸš€ Creating VMs..."
          ./scripts/create-vms.sh
          ;;
        "destroy")
          echo "ğŸ—‘ï¸ Destroying VMs..."
          multipass delete --all --purge
          echo "âœ… All VMs destroyed"
          ;;
        "restart")
          echo "ğŸ”„ Restarting VMs..."
          multipass restart --all
          echo "âœ… All VMs restarted"
          ;;
        "status")
          echo "ğŸ“Š VM Status:"
          multipass list
          echo ""
          echo "ğŸ’¾ Host Resources:"
          free -h
          ;;
        *)
          echo "âŒ Unknown action: ${{ parameters.action }}"
          exit 1
          ;;
      esac
      
      echo ""
      echo "Current VM Status:"
      multipass list